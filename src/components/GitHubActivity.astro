---
interface Props {
  username?: string;
  lang: 'en' | 'zh';
}

const { username = 'Sleepstars', lang } = Astro.props;
---

<section class="mb-12">
  <div class="bg-white dark:bg-gray-900 rounded-lg p-6 shadow-lg">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
        {lang === 'zh' ? 'GitHub 活动概览' : 'GitHub Activity Overview'}
      </h2>
      <a 
        href={`https://github.com/${username}`}
        target="_blank"
        rel="noopener noreferrer"
        class="text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1"
      >
        @{username}
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
        </svg>
      </a>
    </div>
    
    <!-- GitHub Calendar will be rendered here -->
    <div id="github-calendar" class="github-calendar w-full overflow-x-auto"></div>
  </div>
</section>

<script>
  import GitHubCalendar from 'github-calendar';
  
  // Initialize GitHub Calendar when component loads
  document.addEventListener('astro:page-load', () => {
    const calendarElement = document.getElementById('github-calendar');
    if (calendarElement && !calendarElement.hasChildNodes()) {
      GitHubCalendar('.github-calendar', 'Sleepstars', {
        responsive: true,
        tooltips: true,
        global_stats: false,
        cache: true,
        proxy: 'https://cors-anywhere.herokuapp.com/https://github.com/users/Sleepstars/contributions'
      });
    }
  });

  // Also initialize on initial page load
  document.addEventListener('DOMContentLoaded', () => {
    const calendarElement = document.getElementById('github-calendar');
    if (calendarElement && !calendarElement.hasChildNodes()) {
      GitHubCalendar('.github-calendar', 'Sleepstars', {
        responsive: true,
        tooltips: true,
        global_stats: false,
        cache: true
      });
    }
  });
</script>

<style>
  :global(.github-calendar) {
    font-family: Inter, system-ui, sans-serif;
    font-size: 14px;
  }
  
  :global(.github-calendar .calendar-graph) {
    width: 100%;
  }
  
  :global(.github-calendar .js-calendar-graph-table) {
    width: 100%;
  }
  
  :global(.dark .contrib-legend) {
    color: #9ca3af;
  }
  
  :global(.dark .calendar-graph .wday, 
          .dark .calendar-graph .month) {
    fill: #9ca3af;
  }
  
  :global(.dark .contrib-number) {
    color: #e5e7eb;
  }
</style>
