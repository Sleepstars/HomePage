---
import Layout from '../../layouts/Layout.astro';
import SocialLinks from '../SocialLinks.astro';
import BlogPosts from '../BlogPosts.astro';
import type { SocialLink } from '../SocialLinks.astro';
import { useTranslations } from '../../i18n/utils';
import type { Language } from '../../i18n/translations';
import type { BlogPost } from '../../types/blog';
import { getEntry } from 'astro:content';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

async function resolveHeroContent(locale: Language) {
  try {
    const entry = await getEntry('home', locale);
    return entry?.data.hero;
  } catch (error) {
    return undefined;
  }
}

const heroContent = (await resolveHeroContent(lang)) ?? (await resolveHeroContent('en')) ?? {
  greeting: '',
  paragraphs: [] as string[]
};

let blogPosts: BlogPost[] = [];
try {
  const feedEntry = await getEntry('blog', 'feed');
  if (Array.isArray(feedEntry?.data)) {
    blogPosts = feedEntry.data;
  }
} catch (error) {
  console.warn('Unable to load blog feed data:', error);
}

const socialLinks: SocialLink[] = [
  {
    name: 'GitHub',
    url: 'https://github.com/Sleepstars',
    icon: 'github',
    enabled: true
  },
  {
    name: 'Telegram',
    url: 'https://t.me/Sleepstars',
    icon: 'telegram',
    enabled: true
  },
  {
    name: 'YouTube',
    url: 'https://www.youtube.com/@Sleepstars',
    icon: 'youtube',
    enabled: false
  },
  {
    name: 'Mastodon',
    url: 'https://mastodon.social/@Sleepstars',
    icon: 'mastodon',
    enabled: true
  },
  {
    name: 'Twitter',
    url: 'https://x.com/Sleep_stars_',
    icon: 'x',
    enabled: true
  },
  {
    name: 'Instagram',
    url: 'https://instagram.com/Sleepstars',
    icon: 'instagram',
    enabled: false
  }
];
---

<Layout title={t('site.title')} description={t('site.description')} lang={lang}>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <section class="mb-16">
      <h1 data-i18n-key="site.title" class="text-4xl sm:text-5xl font-bold mb-6 bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent">
        {t('site.title')}
      </h1>

      <div class="prose dark:prose-invert max-w-none">
        <p class="text-lg text-gray-700 dark:text-gray-300 mb-6">
          {heroContent.greeting}
        </p>

        {heroContent.paragraphs.map((paragraph, index) => (
          <p class={`text-base text-gray-700 dark:text-gray-300 ${index === 0 ? 'mt-6' : 'mt-4'}`}>
            {paragraph}
          </p>
        ))}
      </div>
    </section>

    <hr class="border-gray-200 dark:border-gray-800 mb-12" />

    <section class="mb-16">
      <h2 data-i18n-key="social.title" class="text-2xl font-semibold mb-6 text-gray-900 dark:text-gray-100">
        {t('social.title')}
      </h2>

      <SocialLinks links={socialLinks} />

      <div class="mt-6 text-gray-700 dark:text-gray-300">
        <span data-i18n-key="social.email">{t('social.email')}</span>
        <a
          href="mailto:admin@sleepstars.net"
          class="ml-3 inline-flex items-center gap-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200"
          aria-label="Email admin@sleepstars.net"
        >
          <span
            class="si w-5 h-5 opacity-90 hover:opacity-100 transition-opacity duration-200"
            style="--si: url('/icons/gmail.svg')"
            aria-hidden="true"
          />
          <span class="text-sm font-medium">admin@sleepstars.net</span>
        </a>
        <p class="mt-4 text-sm text-gray-600 dark:text-gray-400">
          OpenPGP key: <span class="font-mono">8355FCF554DB19D6D9741D84834B70904BD9AB85</span>
        </p>
      </div>
    </section>

    <hr class="border-gray-200 dark:border-gray-800 mb-12" />

    <section class="mb-16">
      <div class="flex items-center justify-between mb-6">
        <h2 data-i18n-key="blog.title" class="text-2xl font-semibold text-gray-900 dark:text-gray-100">
          {t('blog.title')}
        </h2>
        <div class="flex items-center gap-4">
          <a
            href="https://blog.sleepstars.net/rss.xml"
            target="_blank"
            rel="noopener noreferrer"
            class="flex items-center gap-2 text-sm text-orange-600 dark:text-orange-400 hover:text-orange-700 dark:hover:text-orange-300 transition-colors"
            aria-label={t('blog.rss')}
          >
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M3.429 2.571c8.571 0 15.429 6.857 15.429 15.429h-3.429c0-6.857-5.714-12.571-12.571-12.571v-2.857zM3.429 8c4.571 0 8.571 4 8.571 8.571h-2.857c0-3.429-2.286-5.714-5.714-5.714v-2.857zM6.857 15.429c0 1.143-.857 2.286-2 2.286s-2-1.143-2-2.286.857-2.286 2-2.286 2 1.143 2 2.286z"/>
            </svg>
            <span>{t('blog.rss')}</span>
          </a>
          <a
            href="https://blog.sleepstars.net"
            target="_blank"
            rel="noopener noreferrer"
            class="text-sm text-blue-600 dark:text-blue-400 hover:underline"
            data-i18n-key="blog.viewAll"
          >
            {t('blog.viewAll')}
          </a>
        </div>
      </div>

      <BlogPosts posts={blogPosts} lang={lang} />
    </section>
  </div>
</Layout>

<style>
  @reference "../../styles/global.css";

  .prose a {
    @apply text-blue-600 dark:text-blue-400 hover:underline;
  }

  .prose strong {
    @apply font-semibold;
  }
</style>
